<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prospects - Financement LED</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            position: relative;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 20px 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(180deg); }
        }

        .header h1 {
            font-size: 1.6em;
            margin-bottom: 8px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 30px 20px;
        }

        .location-status {
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
            border: 1px solid #bee5eb;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            text-align: center;
            color: #0c5460;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .location-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .location-status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #ffeaa7 100%);
            border-color: #f5c6cb;
            color: #721c24;
        }

        .location-status.success {
            background: linear-gradient(135deg, #d4edda 0%, #a8e6cf 100%);
            border-color: #c3e6cb;
            color: #155724;
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .form-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e8ecf0;
            border-radius: 14px;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #f8f9fa;
            position: relative;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-group input:focus + label {
            color: #667eea;
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover, .btn:active {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            padding: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .btn-secondary:hover, .btn-secondary:active {
            box-shadow: 0 8px 25px rgba(127, 140, 141, 0.3);
        }

        .btn-agenda {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            padding: 16px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .btn-agenda:hover, .btn-agenda:active {
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.4);
        }

        .prospects-list {
            display: none;
            margin-top: 25px;
            border-top: 1px solid #eee;
            padding-top: 25px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .prospects-list.show {
            display: block;
        }

        .prospect-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .prospect-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.3), transparent);
        }

        .prospect-item:hover {
            transform: translateX(8px) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .prospect-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 6px;
            font-size: 16px;
        }

        .prospect-company {
            color: #667eea;
            font-size: 14px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .prospect-email {
            color: #7f8c8d;
            font-size: 13px;
            margin-bottom: 6px;
        }

        .prospect-location {
            color: #95a5a6;
            font-size: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .location-link {
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .location-link:hover {
            color: #5a67d8;
        }

        .prospect-actions {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 10px;
            align-items: center;
        }

        .btn-email {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-agenda-small {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-delete {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-email:active, .btn-agenda-small:active, .btn-delete:active {
            transform: scale(0.95);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.6em;
            font-weight: 700;
            color: #667eea;
            display: block;
        }

        .stat-label {
            font-size: 11px;
            color: #7f8c8d;
            margin-top: 4px;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }

        .empty-state .icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .success-message {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .toggle-icon {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 12px;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        /* Optimisations tactiles */
        @media (hover: none) {
            .btn:hover {
                transform: none;
                box-shadow: none;
            }
            
            .btn:active {
                transform: scale(0.98);
            }
        }

        /* Loading animation */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Dark mode preparation */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💡 Prospects LED</h1>
            <p>Financement-led.com</p>
        </div>

        <div class="main-content">
            <div class="location-status" id="locationStatus">
                📍 Activation de la géolocalisation...
            </div>

            <div class="success-message" id="successMessage">
                ✓ Prospect ajouté avec succès !
            </div>

            <form id="prospectForm">
                <div class="form-group">
                    <label for="name">👤 Nom du prospect</label>
                    <input type="text" id="name" name="name" required autocomplete="given-name" placeholder="ex: Jean Dupont">
                </div>
                
                <div class="form-group">
                    <label for="company">🏢 Entreprise</label>
                    <input type="text" id="company" name="company" required autocomplete="organization" placeholder="ex: Entreprise SAS">
                </div>
                
                <div class="form-group">
                    <label for="email">📧 Email</label>
                    <input type="email" id="email" name="email" required autocomplete="email" placeholder="ex: contact@entreprise.fr">
                </div>
                
                <button type="submit" class="btn" id="submitBtn">
                    ➕ Ajouter le Prospect
                </button>
            </form>

            <button class="btn btn-agenda" id="addToCalendar">
                📅 Ajouter RDV à l'agenda
            </button>

            <button class="btn btn-secondary" id="toggleProspects">
                <span>📋 Voir les prospects (<span id="prospectCount">0</span>)</span>
                <span class="toggle-icon">▼</span>
            </button>

            <div class="prospects-list" id="prospectsList">
                <div class="stats">
                    <div class="stat">
                        <span class="stat-number" id="totalProspects">0</span>
                        <div class="stat-label">Prospects</div>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="emailsSent">0</span>
                        <div class="stat-label">Emails</div>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="rdvCount">0</span>
                        <div class="stat-label">RDV</div>
                    </div>
                </div>

                <div id="prospectsContainer">
                    <div class="empty-state">
                        <div class="icon">📭</div>
                        <p>Aucun prospect encore</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let prospects = [];
        let emailsSentCount = 0;
        let rdvCount = 0;
        let currentLocation = null;
        let locationWatchId = null;

        // Chargement initial des données
        function loadData() {
            try {
                const storedProspects = localStorage.getItem('prospects');
                const storedEmailsCount = localStorage.getItem('emailsSentCount');
                const storedRdvCount = localStorage.getItem('rdvCount');
                
                prospects = storedProspects ? JSON.parse(storedProspects) : [];
                emailsSentCount = storedEmailsCount ? parseInt(storedEmailsCount) : 0;
                rdvCount = storedRdvCount ? parseInt(storedRdvCount) : 0;
                
                console.log('Données chargées:', { prospects: prospects.length, emails: emailsSentCount, rdv: rdvCount });
            } catch (error) {
                console.error('Erreur de chargement des données:', error);
                prospects = [];
                emailsSentCount = 0;
                rdvCount = 0;
            }
        }

        // Template d'email (sans signature)
        const emailTemplate = `Bonjour {name},
je vous remercie de votre intérêt.
Pour faire suite à votre demande d'information, vous trouverez ci-dessous le fonctionnement détaillé de cette opportunité de financement de votre modernisation et remplacement de vos luminaires en technologie LED.

Comment une opération d'éclairage peut-elle être 100% financée ?
La réponse est simple : ce n'est pas nous qui payons, et ce n'est pas vous non plus.
Il s'agit du dispositif des Certificats d'Économies d'Énergie (CEE), un programme piloté par l'État. Il oblige les fournisseurs d'énergie (comme notre partenaire TotalEnergies) à financer activement des projets de réduction de consommation chez les professionnels.

En résumé : votre modernisation est financée par leur obligation légale. C'est un système gagnant-gagnant encadré par la loi (fiche d'opération BAT-EQ-127).

Vos bénéfices directs en 4 points :
✔ Zéro euro à débourser. Ni avance de frais, ni facture. Le matériel (projecteurs LED haute performance) et l'installation par nos techniciens qualifiés sont intégralement pris en charge.
✔ Jusqu'à 80% d'économies immédiates sur le poste "éclairage" de votre facture d'électricité, dès la mise en service.
✔ Zéro démarche administrative. Notre équipe s'occupe de la totalité du montage et du suivi du dossier. Votre temps est précieux, nous le gérons pour vous.
✔ Qualité et sécurité garanties. L'ensemble de l'installation est validé par un organisme de contrôle indépendant et agréé (Apave, Bureau Veritas, etc.) pour certifier la conformité et la qualité des travaux.

Pour visualiser concrètement le résultat et la qualité de la technologie que nous installons, vous pouvez consulter notre site :
https://financement-led.com

La prochaine étape ?
Le plus simple est de planifier un court appel de 15 minutes. Cela nous permettra de valider l'éligibilité technique de vos locaux et de répondre à toutes vos questions.

Vous pouvez réserver directement le créneau qui vous arrange dans mon agenda ou répondre simplement à cet e-mail avec vos disponibilités.

Je reste à votre entière disposition.

Bien cordialement,

financement-led.com`;

        // Fonction pour obtenir la géolocalisation
        function initGeolocation() {
            const statusEl = document.getElementById('locationStatus');
            
            if (!navigator.geolocation) {
                statusEl.textContent = '❌ Géolocalisation non supportée';
                statusEl.className = 'location-status error';
                return;
            }

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 300000
            };

            navigator.geolocation.getCurrentPosition(
                position => {
                    currentLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    statusEl.textContent = '✅ Position activée';
                    statusEl.className = 'location-status success';
                    
                    setTimeout(() => {
                        statusEl.style.display = 'none';
                    }, 3000);
                },
                error => {
                    let message = '❌ ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += 'Permission refusée';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += 'Position indisponible';
                            break;
                        case error.TIMEOUT:
                            message += 'Délai dépassé';
                            break;
                        default:
                            message += 'Erreur inconnue';
                            break;
                    }
                    statusEl.textContent = message;
                    statusEl.className = 'location-status error';
                    
                    setTimeout(() => {
                        statusEl.style.display = 'none';
                    }, 5000);
                },
                options
            );

            locationWatchId = navigator.geolocation.watchPosition(
                position => {
                    currentLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                },
                () => {},
                options
            );
        }

        // Fonction pour obtenir une adresse approximative
        async function getApproximateAddress(lat, lon) {
            try {
                const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=fr`);
                const data = await response.json();
                
                if (data.city && data.countryName) {
                    return `${data.city}, ${data.countryName}`;
                } else if (data.locality && data.countryName) {
                    return `${data.locality}, ${data.countryName}`;
                } else {
                    return `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                }
            } catch (error) {
                return `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
            }
        }

        function saveData() {
            try {
                localStorage.setItem('prospects', JSON.stringify(prospects));
                localStorage.setItem('emailsSentCount', emailsSentCount.toString());
                localStorage.setItem('rdvCount', rdvCount.toString());
            } catch (error) {
                console.error('Erreur de sauvegarde:', error);
            }
        }

        function addProspect(name, company, email) {
            const prospect = {
                id: Date.now(),
                name: name,
                company: company,
                email: email,
                dateAdded: new Date().toLocaleDateString('fr-FR'),
                timeAdded: new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}),
                location: currentLocation ? {
                    latitude: currentLocation.latitude,
                    longitude: currentLocation.longitude,
                    accuracy: currentLocation.accuracy
                } : null
            };
            prospects.unshift(prospect);
            saveData();
            renderProspects();
            updateStats();
            showSuccessMessage();
        }

        function deleteProspect(id) {
            if (confirm('Supprimer ce prospect ?')) {
                prospects = prospects.filter(p => p.id !== id);
                saveData();
                renderProspects();
                updateStats();
            }
        }

        function sendEmail(prospect) {
            const personalizedEmail = emailTemplate.replace('{name}', prospect.name);
            const subject = `Suite à ma visite - Financement LED 100% - ${prospect.company}`;
            
            const yourEmail = 'votre.email@example.com';
            
            const mailtoUrl = `mailto:${prospect.email}?cc=${yourEmail}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(personalizedEmail)}`;
            
            window.location.href = mailtoUrl;
            
            emailsSentCount++;
            saveData();
            updateStats();
        }

        function addToAgenda(prospect) {
            const title = `RDV ${prospect.name} - ${prospect.company}`;
            const details = `Rendez-vous avec ${prospect.name} de ${prospect.company} pour présentation financement LED.\\n\\nEmail: ${prospect.email}`;
            
            // Format pour Google Calendar
            const startDate = new Date();
            startDate.setDate(startDate.getDate() + 1); // Demain
            startDate.setHours(14, 0, 0, 0); // 14h00
            
            const endDate = new Date(startDate);
            endDate.setMinutes(endDate.getMinutes() + 30); // 30 minutes
            
            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z/${endDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z&details=${encodeURIComponent(details)}&location=${prospect.location ? `${prospect.location.latitude},${prospect.location.longitude}` : ''}`;
            
            window.open(googleCalendarUrl, '_blank');
            
            rdvCount++;
            saveData();
            updateStats();
        }

        function addGeneralAgenda() {
            const title = 'RDV Prospect - Financement LED';
            const details = 'Rendez-vous prospect pour présentation financement LED 100%';
            
            const startDate = new Date();
            startDate.setDate(startDate.getDate() + 1);
            startDate.setHours(14, 0, 0, 0);
            
            const endDate = new Date(startDate);
            endDate.setMinutes(endDate.getMinutes() + 30);
            
            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z/${endDate.toISOString().replace(/[-:]/g, '').split('.')[0]}Z&details=${encodeURIComponent(details)}`;
            
            window.open(googleCalendarUrl, '_blank');
        }

        async function renderProspects() {
            const container = document.getElementById('prospectsContainer');
            
            if (prospects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">📭</div>
                        <p>Aucun prospect encore</p>
                    </div>
                `;
                return;
            }

            const prospectsHtml = await Promise.all(
                prospects.slice(0, 10).map(async prospect => {
                    let locationHtml = '';
                    
                    if (prospect.location) {
                        const address = await getApproximateAddress(prospect.location.latitude, prospect.location.longitude);
                        const mapsUrl = `https://www.google.com/maps?q=${prospect.location.latitude},${prospect.location.longitude}`;
                        locationHtml = `
                            <div class="prospect-location">
                                📍 <a href="${mapsUrl}" target="_blank" class="location-link">${address}</a>
                            </div>
                        `;
                    } else {
                        locationHtml = `
                            <div class="prospect-location">
                                📍 Position non disponible
                            </div>
                        `;
                    }

                    return `
                        <div class="prospect-item">
                            <div class="prospect-name">${prospect.name}</div>
                            <div class="prospect-company">${prospect.company}</div>
                            <div class="prospect-email">${prospect.email}</div>
                            ${locationHtml}
                            <div class="prospect-actions">
                                <button class="btn-email" onclick="sendEmail(${JSON.stringify(prospect).replace(/"/g, '&quot;')})">
                                    📧 Email
                                </button>
                                <button class="btn-agenda-small" onclick="addToAgenda(${JSON.stringify(prospect).replace(/"/g, '&quot;')})">
                                    📅
                                </button>
                                <button class="btn-delete" onclick="deleteProspect(${prospect.id})">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `;
                })
            );

            container.innerHTML = prospectsHtml.join('');
        }

        function updateStats() {
            document.getElementById('totalProspects').textContent = prospects.length;
            document.getElementById('prospectCount').textContent = prospects.length;
            document.getElementById('emailsSent').textContent = emailsSentCount;
            document.getElementById('rdvCount').textContent = rdvCount;
        }

        function showSuccessMessage() {
            const msg = document.getElementById('successMessage');
            msg.style.display = 'block';
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        // Event Listeners
        document.getElementById('toggleProspects').addEventListener('click', function() {
            const list = document.getElementById('prospectsList');
            const icon = this.querySelector('.toggle-icon');
            
            if (list.classList.contains('show')) {
                list.classList.remove('show');
                icon.classList.remove('rotated');
            } else {
                list.classList.add('show');
                icon.classList.add('rotated');
            }
        });

        document.getElementById('addToCalendar').addEventListener('click', addGeneralAgenda);

        document.getElementById('prospectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const company = document.getElementById('company').value.trim();
            const email = document.getElementById('email').value.trim();
            
            if (name && company && email) {
                addProspect(name, company, email);
                this.reset();
                
                const btn = document.getElementById('submitBtn');
                const originalBg = btn.style.background;
                const originalText = btn.textContent;
                
                btn.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                btn.textContent = '✓ Ajouté !';
                
                setTimeout(() => {
                    btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    btn.textContent = originalText;
                }, 2000);
                
                // Refocus sur le premier champ
                document.getElementById('name').focus();
            }
        });

        // Nettoyage à la fermeture
        window.addEventListener('beforeunload', () => {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
            }
        });

        // Initialisation complète
        function init() {
            console.log('Initialisation de l\'application...');
            loadData();
            initGeolocation();
            initPWA();
            renderProspects();
            updateStats();
            
            // Auto-focus
            setTimeout(() => {
                document.getElementById('name').focus();
            }, 500);
        }

        // Lancement au chargement de la page
        document.addEventListener('DOMContentLoaded', init);
        
        // Fallback si DOMContentLoaded a déjà été déclenché
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
